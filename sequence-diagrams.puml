@startuml
!theme plain
skinparam sequenceMessageAlign center
skinparam roundcorner 10

' ============================================
' 고객 시퀀스 다이어그램
' ============================================

== 고객 - 주문 하기 ==
actor 고객
participant "React Client" as Client
participant "OrderController" as Controller
participant "OrderService" as OrderService
participant "InventoryService" as InventoryService
participant "PaymentService" as PaymentService
database "Order DB" as OrderDB
database "Inventory DB" as InventoryDB

고객 -> Client: 주문 정보 입력
Client -> Controller: POST /api/orders
Controller -> Controller: JWT 인증 확인
Controller -> OrderService: createOrder()
OrderService -> InventoryService: 재고 예약 확인
InventoryService -> InventoryDB: 재고 조회
InventoryDB --> InventoryService: 재고 정보
InventoryService --> OrderService: 재고 예약 완료
OrderService -> PaymentService: 결제 처리
PaymentService --> OrderService: 결제 완료
OrderService -> OrderDB: 주문 저장
OrderDB --> OrderService: 주문 ID 반환
OrderService --> Controller: 주문 생성 완료
Controller --> Client: 주문 정보 응답
Client --> 고객: 주문 완료 표시

== 고객 - 주문 내역 조회 ==
actor 고객
participant "React Client" as Client2
participant "OrderController" as Controller2
participant "OrderService" as OrderService2
database "Order DB" as OrderDB2

고객 -> Client2: 주문 내역 조회 요청
Client2 -> Controller2: GET /api/orders
Controller2 -> Controller2: JWT 인증 확인
Controller2 -> OrderService2: getOrdersByUserId()
OrderService2 -> OrderDB2: 주문 조회
OrderDB2 --> OrderService2: 주문 목록
OrderService2 --> Controller2: 주문 목록 반환
Controller2 --> Client2: 주문 목록 응답
Client2 --> 고객: 주문 내역 표시

== 고객 - 예약 변경 요청 ==
actor 고객
participant "React Client" as Client3
participant "ReservationChangeRequestController" as Controller3
participant "OrderChangeRequestService" as ChangeService
participant "PaymentService" as PaymentService3
database "Order DB" as OrderDB3
database "ChangeRequest DB" as ChangeDB

고객 -> Client3: 예약 변경 요청
Client3 -> Controller3: POST /api/reservations/{id}/change-requests
Controller3 -> Controller3: JWT 인증 확인
Controller3 -> ChangeService: createChangeRequest()
ChangeService -> OrderDB3: 기존 주문 조회
OrderDB3 --> ChangeService: 주문 정보
ChangeService -> ChangeService: 변경 수수료 계산
ChangeService -> ChangeDB: 변경 요청 저장
ChangeDB --> ChangeService: 요청 ID 반환
alt 차액 발생
    ChangeService -> PaymentService3: 차액 결제
    PaymentService3 --> ChangeService: 결제 완료
end
ChangeService --> Controller3: 변경 요청 생성 완료
Controller3 --> Client3: 변경 요청 정보 응답
Client3 --> 고객: 변경 요청 완료 표시

' ============================================
' 관리자 시퀀스 다이어그램
' ============================================

== 관리자 - 주문 관리 (승인/반려) ==
actor 관리자
participant "React Client" as AdminClient
participant "AdminController" as AdminController
participant "OrderService" as AdminOrderService
database "Order DB" as AdminOrderDB

관리자 -> AdminClient: 주문 목록 조회
AdminClient -> AdminController: GET /api/admin/orders
AdminController -> AdminController: 관리자 권한 확인
AdminController -> AdminOrderService: getAllOrders()
AdminOrderService -> AdminOrderDB: 전체 주문 조회
AdminOrderDB --> AdminOrderService: 주문 목록
AdminOrderService --> AdminController: 주문 목록 반환
AdminController --> AdminClient: 주문 목록 응답
AdminClient --> 관리자: 주문 목록 표시

관리자 -> AdminClient: 주문 승인
AdminClient -> AdminController: POST /api/admin/orders/{id}/approve
AdminController -> AdminController: 관리자 권한 확인
AdminController -> AdminOrderService: approveOrder()
AdminOrderService -> AdminOrderDB: 주문 상태 업데이트
AdminOrderDB --> AdminOrderService: 업데이트 완료
AdminOrderService --> AdminController: 승인 완료
AdminController --> AdminClient: 승인 결과 응답
AdminClient --> 관리자: 승인 완료 표시

== 관리자 - 예약 변경 요청 관리 ==
actor 관리자
participant "React Client" as AdminClient2
participant "AdminReservationChangeRequestController" as AdminChangeController
participant "OrderChangeRequestService" as AdminChangeService
participant "PaymentService" as AdminPaymentService
database "ChangeRequest DB" as AdminChangeDB
database "Order DB" as AdminOrderDB2

관리자 -> AdminClient2: 변경 요청 목록 조회
AdminClient2 -> AdminChangeController: GET /api/admin/change-requests
AdminChangeController -> AdminChangeController: 관리자 권한 확인
AdminChangeController -> AdminChangeService: getAdminRequests()
AdminChangeService -> AdminChangeDB: 변경 요청 조회
AdminChangeDB --> AdminChangeService: 변경 요청 목록
AdminChangeService --> AdminChangeController: 변경 요청 목록 반환
AdminChangeController --> AdminClient2: 변경 요청 목록 응답
AdminClient2 --> 관리자: 변경 요청 목록 표시

관리자 -> AdminClient2: 변경 요청 승인
AdminClient2 -> AdminChangeController: POST /api/admin/change-requests/{id}/approve
AdminChangeController -> AdminChangeController: 관리자 권한 확인
AdminChangeController -> AdminChangeService: approve()
AdminChangeService -> AdminOrderDB2: 주문 정보 업데이트
AdminOrderDB2 --> AdminChangeService: 업데이트 완료
alt 차액 환불 필요
    AdminChangeService -> AdminPaymentService: 환불 처리
    AdminPaymentService --> AdminChangeService: 환불 완료
end
AdminChangeService -> AdminChangeDB: 변경 요청 상태 업데이트
AdminChangeDB --> AdminChangeService: 업데이트 완료
AdminChangeService --> AdminChangeController: 승인 완료
AdminChangeController --> AdminClient2: 승인 결과 응답
AdminClient2 --> 관리자: 승인 완료 표시

== 관리자 - 계정 관리 ==
actor 관리자
participant "React Client" as AdminClient3
participant "AdminController" as AdminAccountController
participant "AuthService" as AdminAuthService
database "User DB" as AdminUserDB

관리자 -> AdminClient3: 계정 목록 조회
AdminClient3 -> AdminAccountController: GET /api/admin/accounts
AdminAccountController -> AdminAccountController: 관리자 권한 확인
AdminAccountController -> AdminAuthService: getAllUsers()
AdminAuthService -> AdminUserDB: 사용자 조회
AdminUserDB --> AdminAuthService: 사용자 목록
AdminAuthService --> AdminAccountController: 사용자 목록 반환
AdminAccountController --> AdminClient3: 사용자 목록 응답
AdminClient3 --> 관리자: 계정 목록 표시

관리자 -> AdminClient3: 계정 승인/반려
AdminClient3 -> AdminAccountController: POST /api/admin/accounts/{id}/approve
AdminAccountController -> AdminAccountController: 관리자 권한 확인
AdminAccountController -> AdminAuthService: updateApprovalStatus()
AdminAuthService -> AdminUserDB: 승인 상태 업데이트
AdminUserDB --> AdminAuthService: 업데이트 완료
AdminAuthService --> AdminAccountController: 승인 완료
AdminAccountController --> AdminClient3: 승인 결과 응답
AdminClient3 --> 관리자: 승인 완료 표시

' ============================================
' 직원 시퀀스 다이어그램
' ============================================

== 직원 - 재고 확인 ==
actor 직원
participant "React Client" as EmpClient
participant "InventoryController" as EmpInventoryController
participant "InventoryService" as EmpInventoryService
database "Inventory DB" as EmpInventoryDB

직원 -> EmpClient: 재고 조회 요청
EmpClient -> EmpInventoryController: GET /api/inventory
EmpInventoryController -> EmpInventoryController: 직원 권한 확인
EmpInventoryController -> EmpInventoryService: getInventory()
EmpInventoryService -> EmpInventoryDB: 재고 정보 조회
EmpInventoryDB --> EmpInventoryService: 재고 정보
EmpInventoryService --> EmpInventoryController: 재고 정보 반환
EmpInventoryController --> EmpClient: 재고 정보 응답
EmpClient --> 직원: 재고 정보 표시

== 직원 - 스케줄 조회 ==
actor 직원
participant "React Client" as EmpClient2
participant "EmployeeController" as EmpScheduleController
participant "DeliverySchedulingService" as EmpScheduleService
database "Schedule DB" as EmpScheduleDB

직원 -> EmpClient2: 스케줄 조회 요청
EmpClient2 -> EmpScheduleController: GET /api/employee/schedule
EmpScheduleController -> EmpScheduleController: 직원 권한 확인
EmpScheduleController -> EmpScheduleService: getEmployeeSchedule()
EmpScheduleService -> EmpScheduleDB: 스케줄 조회
EmpScheduleDB --> EmpScheduleService: 스케줄 정보
EmpScheduleService --> EmpScheduleController: 스케줄 정보 반환
EmpScheduleController --> EmpClient2: 스케줄 정보 응답
EmpClient2 --> 직원: 스케줄 표시

== 직원 - 주문 관리 (상태 변경) ==
actor 직원
participant "React Client" as EmpClient3
participant "EmployeeController" as EmpOrderController
participant "OrderService" as EmpOrderService
participant "InventoryService" as EmpInventoryService2
database "Order DB" as EmpOrderDB
database "Inventory DB" as EmpInventoryDB2

직원 -> EmpClient3: 주문 목록 조회
EmpClient3 -> EmpOrderController: GET /api/employee/orders
EmpOrderController -> EmpOrderController: 직원 권한 확인
EmpOrderController -> EmpOrderService: getOrders()
EmpOrderService -> EmpOrderDB: 주문 조회
EmpOrderDB --> EmpOrderService: 주문 목록
EmpOrderService --> EmpOrderController: 주문 목록 반환
EmpOrderController --> EmpClient3: 주문 목록 응답
EmpClient3 --> 직원: 주문 목록 표시

직원 -> EmpClient3: 조리 시작
EmpClient3 -> EmpOrderController: POST /api/employee/orders/{id}/start-cooking
EmpOrderController -> EmpOrderController: 직원 권한 확인
EmpOrderController -> EmpOrderService: startCooking()
EmpOrderService -> EmpOrderDB: 주문 상태 확인
EmpOrderDB --> EmpOrderService: 주문 정보
EmpOrderService -> EmpInventoryService2: 재고 차감
EmpInventoryService2 -> EmpInventoryDB2: 재고 차감 처리
EmpInventoryDB2 --> EmpInventoryService2: 차감 완료
EmpInventoryService2 --> EmpOrderService: 재고 차감 완료
EmpOrderService -> EmpOrderDB: 주문 상태 업데이트 (cooking)
EmpOrderDB --> EmpOrderService: 업데이트 완료
EmpOrderService --> EmpOrderController: 조리 시작 완료
EmpOrderController --> EmpClient3: 조리 시작 결과 응답
EmpClient3 --> 직원: 조리 시작 완료 표시

@enduml


